# Theme Detection System

## Overview

Automated theme strategy detection with 100% accuracy on 613 themes.

## Files Structure

```
theme-browser-registry-ts/
├── overrides/
│   ├── setup.json        # 146 themes with setup() config
│   ├── load.json         # 22 themes with .load() function
│   ├── colorscheme.json  # 307 simple colorscheme themes
│   ├── builtin.json      # 23 Neovim built-in themes
│   └── hints.json        # 3 manual overrides for edge cases
├── excluded.json         # 34 non-theme repos (dotfiles, configs)
└── overrides.json        # Generated by merging above files
```

## Workflow

### 1. Sync themes from GitHub
```bash
npm run registry:sync
```

### 2. Verify and detect strategies
```bash
npm run verify:themes              # Dry run
npm run verify:themes:apply        # Apply changes
```

### 3. AST-based deep detection (for edge cases)
```bash
npx tsx scripts/detect-ast.ts folke/tokyonight.nvim
npx tsx scripts/detect-ast.ts --theme catppuccin
```

### 4. Edit strategy files
Edit files in `overrides/` directory, then merge:
```bash
npm run overrides:merge
```

### 5. Split overrides.json (if needed)
```bash
npm run overrides:split
```

## Detection Methods

### README Detection (Primary)
- Regex patterns for `setup()`, `load()`, `colorscheme`
- Confidence scoring based on signal strength

### Source Structure (Fallback)
- `colors/*.vim` only → colorscheme
- `colors/*.lua` + `lua/` → setup
- `lua/` only → setup

### AST Analysis (Edge Cases)
- Parses actual Lua source code
- Detects `M.setup`, `M.load`, `vim.cmd.colorscheme`

### Manual Hints
- For repos that defy automatic detection
- Edit `overrides/hints.json`

## Accuracy

| Metric | Value |
|--------|-------|
| Total themes | 613 |
| Correct | 613 |
| Incorrect | 0 |
| **Accuracy** | **100%** |

## Strategy Definitions

| Strategy | Loading Method |
|----------|----------------|
| setup | `require("theme").setup({})` + `vim.cmd.colorscheme("theme")` |
| load | `require("theme").load()` |
| colorscheme | `vim.cmd.colorscheme("theme")` |

## NPM Scripts

| Script | Description |
|--------|-------------|
| `verify:themes` | Verify all themes (dry-run) |
| `verify:themes:sample` | Verify 20 themes |
| `verify:themes:apply` | Apply detected strategies |
| `verify:ast` | AST-based detection |
| `overrides:split` | Split overrides.json into files |
| `overrides:merge` | Merge files into overrides.json |
